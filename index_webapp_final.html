<!DOCTYPE html>
<html lang="uk">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <title>Ğ“Ñ€Ğ° "Ğ¡ĞºÑ€Ğ¸Ğ½ÑŒĞºĞ¸"</title>
Â  Â  <style>
Â  Â  Â  Â  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: #f0f0f0; margin: 0; padding: 20px; text-align: center; }
        .game-container { max-width: 800px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .card-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin-top: 15px; }
        .card { width: 55px; height: 80px; border: 1px solid #ccc; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 1.1em; font-weight: bold; background-color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: transform 0.2s ease-in-out; }
        .card:hover { transform: translateY(-3px); }
        .hearts, .diamonds { color: red; }
        .clubs, .spades { color: black; }
        .game-state-message { font-size: 1.2em; margin-bottom: 15px; font-weight: bold; }
        #log { max-height: 150px; overflow-y: scroll; border: 1px solid #ddd; padding: 10px; margin-top: 10px; text-align: left; background-color: #f9f9f9; border-radius: 5px; font-size: 0.9em; line-height: 1.4; }
        #controls { margin-top: 15px; }
        button, select, input { padding: 8px 15px; margin: 4px; font-size: 0.9em; border: 1px solid #ccc; border-radius: 4px; cursor: pointer; transition: background-color 0.2s; }
        button:hover { background-color: #e9e9e9; }
        button:active { background-color: #dcdcdc; }
        button:disabled { background-color: #cccccc; cursor: not-allowed; }
        #player-hand { display: flex; flex-wrap: wrap; justify-content: center; margin-bottom: 15px; }
        .collected-boxes { margin-top: 15px; text-align: left; font-size: 0.9em; }
        .hidden { display: none !important; }
        .lobby-inputs input { width: 180px; }
        .lobby-inputs button { width: 370px; }
		
		/* ĞĞ¾Ğ²Ñ– ÑÑ‚Ğ¸Ğ»Ñ– Ğ´Ğ»Ñ Ğ¾Ñ…Ğ°Ğ¹Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ğ¸Ğ³Ğ»ÑĞ´Ñƒ */
        h1 { margin-bottom: 10px; }
        p { margin: 5px 0; }
        ul { list-style-type: none; padding: 0; }
        ul li { margin: 3px 0; font-size: 0.9em; }
        #game-info { text-align: left; margin-top: 20px; }
		
        /* ğŸ”½ Ğ’Ñ–Ğ´ÑÑ‚ÑƒĞ¿ Ğ¼Ñ–Ğ¶ Ğ¼Ğ°ÑÑ‚ÑĞ¼Ğ¸ Ñ‚Ğ° ĞºĞ½Ğ¾Ğ¿ĞºĞ¾Ñ */
        #suits-checkboxes { 
            margin-bottom: 2em; /* Ğ·Ğ¼Ñ–Ğ½Ğ¸ Ğ½Ğ° 1.5em ÑĞºÑ‰Ğ¾ Ñ…Ğ¾Ñ‡ĞµÑˆ Ğ¼ĞµĞ½ÑˆĞ¸Ğ¹ Ğ²Ñ–Ğ´ÑÑ‚ÑƒĞ¿ */
            display: flex;
            justify-content: space-around; /* Ğ°Ğ±Ğ¾ space-between Ğ´Ğ»Ñ Ñ‡Ñ–Ñ‚ĞºĞ¾Ğ³Ğ¾ Ñ€Ğ¾Ğ·ĞºĞ¸Ğ´Ñƒ */
            max-width: 400px; /* Ğ¾Ğ±Ğ¼ĞµĞ¶ ÑˆĞ¸Ñ€Ğ¸Ğ½Ñƒ, Ñ‰Ğ¾Ğ± Ğ½Ğµ Ğ±ÑƒĞ»Ğ¾ Ğ·Ğ°Ğ½Ğ°Ğ´Ñ‚Ğ¾ Ñ€Ğ¾Ğ·Ñ‚ÑĞ³Ğ½ÑƒÑ‚Ğ¾ */
            margin: 0 auto 2em auto; /* Ñ†ĞµĞ½Ñ‚Ñ€ Ğ¿Ğ¾ Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»Ñ– + Ğ²Ñ–Ğ´ÑÑ‚ÑƒĞ¿ Ğ·Ğ½Ğ¸Ğ·Ñƒ */
                          }
        /* ğŸ”½ Ğ Ğ¾Ğ·Ğ¿Ğ¾Ğ´Ñ–Ğ» ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº "Ğ¢Ğ°Ğº" / "ĞÑ–" Ğ¿Ğ¾ ÑˆĞ¸Ñ€Ğ¸Ğ½Ñ– */
        #response-buttons {
            display: flex;
            justify-content: space-around; /* Ğ°Ğ±Ğ¾ space-between Ğ´Ğ»Ñ Ñ€Ğ¾Ğ·Ñ‚ÑĞ³ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ¿Ğ¾ ĞºÑ€Ğ°ÑÑ… */
            gap: 1em; /* Ğ¿Ñ€Ğ¾Ğ¼Ñ–Ğ¶Ğ¾Ğº Ğ¼Ñ–Ğ¶ ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ğ¼Ğ¸ */
            margin-top: 1em; /* Ğ²Ñ–Ğ´ÑÑ‚ÑƒĞ¿ Ğ·Ğ²ĞµÑ€Ñ…Ñƒ Ğ²Ñ–Ğ´ Ñ‚ĞµĞºÑÑ‚Ñƒ */
        }
Â  Â  </style>
</head>
<body>
Â  Â  <div class="game-container">
Â  Â  Â  Â  <h1>Ğ“Ñ€Ğ° "Ğ¡ĞºÑ€Ğ¸Ğ½ÑŒĞºĞ¸"</h1>

Â  Â  Â  Â  <div id="lobby">
Â  Â  Â  Â  Â  Â  <p>Ğ’Ğ¸Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ Ñ–Ğ¼'Ñ Ñ‚Ğ° ĞºÑ–Ğ¼Ğ½Ğ°Ñ‚Ñƒ Ğ´Ğ»Ñ Ğ³Ñ€Ğ¸.</p>
Â  Â  Â  Â  Â  Â  <input type="text" id="player-name-input" placeholder="Ğ’Ğ°ÑˆĞµ Ñ–Ğ¼'Ñ">
Â  Â  Â  Â  Â  Â  <input type="text" id="room-id-input" placeholder="ID ĞºÑ–Ğ¼Ğ½Ğ°Ñ‚Ğ¸">
Â  Â  Â  Â  Â  Â  <button onclick="joinRoom()">ĞŸÑ€Ğ¸Ñ”Ğ´Ğ½Ğ°Ñ‚Ğ¸ÑÑ / Ğ¡Ñ‚Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğ¸ ĞºÑ–Ğ¼Ğ½Ğ°Ñ‚Ñƒ</button>
Â  Â  Â  Â  Â  Â  <p id="lobby-message"></p>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="game" style="display: none;">
Â  Â  Â  Â  Â  Â  <div class="game-state-message" id="game-status">ĞÑ‡Ñ–ĞºÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ½Ğ° Ğ³Ñ€Ğ°Ğ²Ñ†Ñ–Ğ²...</div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div id="controls">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="game-actions" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Ğ’Ğ°Ñˆ Ñ…Ñ–Ğ´, <span id="current-player-name"></span>! Ğ’Ğ¸Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ Ğ³Ñ€Ğ°Ğ²Ñ†Ñ Ñ‚Ğ° ĞºĞ°Ñ€Ñ‚Ñƒ Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ñƒ.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="target-player-select"></select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="card-rank-select">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Ğ’Ğ¸Ğ±Ñ€Ğ°Ñ‚Ğ¸ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="6">6</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="7">7</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="8">8</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="9">9</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="10">10</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="J">J</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Q">Q</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="K">K</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="A">A</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="askForCard()">Ğ—Ğ°Ğ¿Ğ¸Ñ‚Ğ°Ñ‚Ğ¸</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>


                <div id="guess-count" style="display: none;">
                    <p>Ğ’Ğ³Ğ°Ğ´Ğ°Ğ¹Ñ‚Ğµ, ÑĞºÑ–Ğ»ÑŒĞºĞ¸ ĞºĞ°Ñ€Ñ‚ Ğ· Ñ†Ğ¸Ğ¼ Ñ€Ğ°Ğ½Ğ³Ğ¾Ğ¼ Ñ” Ñƒ Ğ²Ğ°ÑˆĞ¾Ğ³Ğ¾ ÑÑƒĞ¿ĞµÑ€Ğ½Ğ¸ĞºĞ°?</p>
                       <select id="card-count-select">  
Â  Â  Â  Â  Â  Â  Â  Â     Â  Â  Â  Â  <option value="">Ğ’Ğ¸Ğ±Ñ€Ğ°Ñ‚Ğ¸ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ</option>  
Â  Â  Â  Â  Â  Â  Â  Â  Â     Â  Â  Â  <option value="1">1</option>  
Â  Â  Â  Â  Â  Â  Â  Â  Â     Â  Â  Â  <option value="2">2</option>  
Â  Â  Â  Â  Â  Â  Â  Â  Â     Â  Â  Â  <option value="3">3</option>   
Â  Â  Â  Â  Â  Â  Â  Â     Â  Â  </select>   
                    <button id="submit-guess-count-btn">Ğ’Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚Ğ¸</button>
                </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div id="guess-suits-form" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Ğ¡ĞºÑ–Ğ»ÑŒĞºĞ¸ Ğ¼Ğ°ÑÑ‚ĞµĞ¹ Ğ²Ğ¸ Ğ²Ğ³Ğ°Ğ´Ğ°Ñ”Ñ‚Ğµ?</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="suits-checkboxes">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label><input type="checkbox" name="suit" value="â™¥"> â™¥</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label><input type="checkbox" name="suit" value="â™¦"> â™¦</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label><input type="checkbox" name="suit" value="â™£"> â™£</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label><input type="checkbox" name="suit" value="â™ "> â™ </label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="guessSuits()">Ğ’Ğ³Ğ°Ğ´Ğ°Ñ‚Ğ¸ Ğ¼Ğ°ÑÑ‚Ñ–</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="response-buttons" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Ğ“Ñ€Ğ°Ğ²ĞµÑ†ÑŒ <span id="asking-player-name"></span> Ğ·Ğ°Ğ¿Ğ¸Ñ‚ÑƒÑ” ĞºĞ°Ñ€Ñ‚Ñƒ <span id="asked-card-rank"></span>. Ğ£ Ğ²Ğ°Ñ Ğ²Ğ¾Ğ½Ğ° Ñ”?</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="respondToAsk('yes')">Ğ¢Ğ°Ğº</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="respondToAsk('no')">ĞÑ–</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="game-info">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="startGameBtn" onclick="startGame()" >Ğ Ğ¾Ğ·Ğ¿Ğ¾Ñ‡Ğ°Ñ‚Ğ¸ Ğ³Ñ€Ñƒ</button>
Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Ğ’Ğ°ÑˆÑ– ĞºĞ°Ñ€Ñ‚Ğ¸:</strong></p>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="player-hand" class="card-container"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Ğ—Ñ–Ğ±Ñ€Ğ°Ğ½Ñ– ÑĞºÑ€Ğ¸Ğ½ÑŒĞºĞ¸:</strong></p>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="collected-boxes" class="collected-boxes"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>ĞšĞ¾Ğ»Ğ¾Ğ´Ğ°:</strong> <span id="deck-size"></span> ĞºĞ°Ñ€Ñ‚</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Ğ“Ñ€Ğ°Ğ²Ñ†Ñ–:</strong></p>
Â  Â  Â  Â  Â  Â  Â  Â  <ul id="players-list"></ul>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="message-box">
Â  Â  Â  Â  Â  Â  <h4>Ğ–ÑƒÑ€Ğ½Ğ°Ğ» Ğ³Ñ€Ğ¸:</h4>
Â  Â  Â  Â  Â  Â  <div id="log"></div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <script src="https://telegram.org/js/telegram-web-app.js"></script>
Â  Â  <script>
Â  Â  Â  Â  const tg = window.Telegram.WebApp;
Â  Â  Â  Â  const WS_URL = "wss://telegram-webapp-beispiel.onrender.com"; // !!! Ğ—Ğ¼Ñ–Ğ½Ñ–Ñ‚ÑŒ Ğ½Ğ° Ğ¿ÑƒĞ±Ğ»Ñ–Ñ‡Ğ½Ñƒ Ğ°Ğ´Ñ€ĞµÑÑƒ Ğ²Ğ°ÑˆĞ¾Ğ³Ğ¾ ÑĞµÑ€Ğ²ĞµÑ€Ğ° !!!
Â  Â  Â  Â  let socket;
Â  Â  Â  Â  let telegramUser = '';
Â  Â  Â  Â  let myName = '';
Â  Â  Â  Â  let myRoomId = '';
Â  Â  Â  Â  let myCards = [];

Â  Â  Â  Â  const elements = {
Â  Â  Â  Â  Â  Â  lobby: document.getElementById('lobby'),
Â  Â  Â  Â  Â  Â  game: document.getElementById('game'),
Â  Â  Â  Â  Â  Â  playerNameInput: document.getElementById('player-name-input'),
Â  Â  Â  Â  Â  Â  roomIdInput: document.getElementById('room-id-input'),
Â  Â  Â  Â  Â  Â  lobbyMessage: document.getElementById('lobby-message'),
Â  Â  Â  Â  Â  Â  gameStatus: document.getElementById('game-status'),
Â  Â  Â  Â  Â  Â  startGameBtn: document.getElementById('startGameBtn'),
Â  Â  Â  Â  Â  Â  gameActions: document.getElementById('game-actions'),
Â  Â  Â  Â  Â  Â  playerHand: document.getElementById('player-hand'),
Â  Â  Â  Â  Â  Â  collectedBoxes: document.getElementById('collected-boxes'),
Â  Â  Â  Â  Â  Â  playersList: document.getElementById('players-list'),
Â  Â  Â  Â  Â  Â  deckSize: document.getElementById('deck-size'),
Â  Â  Â  Â  Â  Â  log: document.getElementById('log'),
Â  Â  Â  Â  Â  Â  targetPlayerSelect: document.getElementById('target-player-select'),
Â  Â  Â  Â  Â  Â  cardRankSelect: document.getElementById('card-rank-select'),
Â  Â  Â  Â  Â  Â  guessSuitsForm: document.getElementById('guess-suits-form'),
            guessCount: document.getElementById('guess-count'),
            guessCountInput: document.getElementById('card-count-select'),
            submitGuessCountBtn: document.getElementById('submit-guess-count-btn'),
Â  Â  Â  Â  Â  Â  suitsCheckboxes: document.getElementById('suits-checkboxes'),
Â  Â  Â  Â  Â  Â  responseButtons: document.getElementById('response-buttons'),
Â  Â  Â  Â  Â  Â  askingPlayerName: document.getElementById('asking-player-name'),
Â  Â  Â  Â  Â  Â  askedCardRank: document.getElementById('asked-card-rank'),
            currentPlayerName: document.getElementById('current-player-name') // Ğ”Ğ¾Ğ´Ğ°Ğ½Ğ¾
Â  Â  Â  Â  };

Â  Â  Â  Â  if (tg) {
Â  Â  Â  Â  Â  Â  tg.ready();
Â  Â  Â  Â  Â  Â  tg.expand();
Â  Â  Â  Â  Â  Â  if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
Â  Â  Â  Â  Â  Â  Â  Â  const u = tg.initDataUnsafe.user;
Â  Â  Â  Â  Â  Â  Â  Â  telegramUser = u.username ? `@${u.username}` : (u.first_name || 'Ğ“Ñ€Ğ°Ğ²ĞµÑ†ÑŒ');
Â  Â  Â  Â  Â  Â  Â  Â  elements.playerNameInput.value = telegramUser;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  telegramUser = "ĞĞ½Ğ¾Ğ½Ñ–Ğ¼Ğ½Ğ¸Ğ¹ Ğ³Ñ€Ğ°Ğ²ĞµÑ†ÑŒ";
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  telegramUser = "Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ğ¸Ğ¹ Ğ³Ñ€Ğ°Ğ²ĞµÑ†ÑŒ";
Â  Â  Â  Â  }

Â  Â  Â  Â  function logMessage(message) {
Â  Â  Â  Â  Â  Â  const p = document.createElement('p');
Â  Â  Â  Â  Â  Â  p.textContent = message;
Â  Â  Â  Â  Â  Â  elements.log.appendChild(p);
Â  Â  Â  Â  Â  Â  elements.log.scrollTop = elements.log.scrollHeight;
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateUI(state, myHand) {
Â  Â  Â  Â  Â  Â  elements.playersList.innerHTML = '';
Â  Â  Â  Â  Â  Â  state.players.forEach(p => {
Â  Â  Â  Â  Â  Â  Â  Â  const li = document.createElement('li');
Â  Â  Â  Â  Â  Â  Â  Â  li.textContent = `${p.name} (${p.is_turn ? 'Ğ¥Ğ¾Ğ´Ğ¸Ñ‚ÑŒ' : 'ĞÑ‡Ñ–ĞºÑƒÑ”'}) - Ğ¡ĞºÑ€Ğ¸Ğ½ÑŒĞ¾Ğº: ${p.collected_boxes}`;
Â  Â  Â  Â  Â  Â  Â  Â  elements.playersList.appendChild(li);
Â  Â  Â  Â  Â  Â  });
            // Ğ”Ğ¾Ğ´Ğ°Ğ¹Ñ‚Ğµ Ñ†ĞµĞ¹ Ñ€ÑĞ´Ğ¾Ğº Ğ´Ğ»Ñ Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ Ñ–Ğ¼ĞµĞ½Ñ– Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ³Ñ€Ğ°Ğ²Ñ†Ñ
            elements.currentPlayerName.textContent = state.current_turn;
Â  Â Â 
Â  Â  Â  Â  Â  Â  // Ğ’Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒÑ”Ğ¼Ğ¾ myHand, Ğ¿ĞµÑ€ĞµĞ´Ğ°Ğ½Ğ¸Ğ¹ ÑĞº Ğ°Ñ€Ğ³ÑƒĞ¼ĞµĞ½Ñ‚
Â  Â  Â  Â  Â  Â  elements.playerHand.innerHTML = '';
Â  Â  Â  Â  Â  Â  if (myHand && myHand.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  myHand.forEach(card => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  div.className = `card ${card.includes('â™¥') || card.includes('â™¦') ? 'hearts' : 'clubs'}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  div.textContent = card;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  elements.playerHand.appendChild(div);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }Â 

Â  Â Â 
Â  Â  Â  Â  Â  Â  elements.collectedBoxes.innerHTML = '';
Â  Â  Â  Â  Â  Â  state.players.find(p => p.name === myName)?.collected_sets.forEach(rank => {
Â  Â  Â  Â  Â  Â  Â  Â  const p = document.createElement('p');
Â  Â  Â  Â  Â  Â  Â  Â  p.textContent = `Ğ—Ñ–Ğ±Ñ€Ğ°Ğ½Ğ¾ ÑĞºÑ€Ğ¸Ğ½ÑŒĞºÑƒ: ${rank}`;
Â  Â  Â  Â  Â  Â  Â  Â  elements.collectedBoxes.appendChild(p);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  elements.deckSize.textContent = state.deck_size;
Â  Â  Â  Â  Â  Â  elements.gameStatus.textContent = state.game_started ? `Ğ“Ñ€Ğ° Ñ€Ğ¾Ğ·Ğ¿Ğ¾Ñ‡Ğ°Ğ»Ğ°ÑÑŒ! Ğ¥Ñ–Ğ´ Ğ³Ñ€Ğ°Ğ²Ñ†Ñ: ${state.current_turn}` : `ĞÑ‡Ñ–ĞºÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ½Ğ° Ğ³Ñ€Ğ°Ğ²Ñ†Ñ–Ğ²... (Ğ’ÑÑŒĞ¾Ğ³Ğ¾ ${state.players.length}/6)`;
Â  Â Â 
Â  Â  Â  Â  Â  Â  handleStartGameButton(state);
Â  Â Â 
Â  Â  Â  Â  Â  Â  hideAllControls();
            const myPlayerState = state.players.find(p => p.name === myName);
Â  Â  Â  Â  Â  Â  if (state.game_started && state.current_turn === myName) {
Â  Â  Â  Â  Â  Â  Â  Â  elements.gameActions.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  elements.targetPlayerSelect.innerHTML = state.players
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .filter(p => p.name !== myName)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .map(p => `<option value="${p.name}">${p.name}</option>`)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .join('');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function handleStartGameButton(state) {
Â  Â  Â  Â  Â  Â  const isRoomAdmin = state.room_admin === myName;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (isRoomAdmin && !state.game_started) {
Â  Â  Â  Â  Â  Â  Â  Â  elements.startGameBtn.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  elements.startGameBtn.disabled = state.players.length < 2;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  elements.startGameBtn.style.display = 'none';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function hideAllControls() {
Â  Â  Â  Â  Â  Â  elements.gameActions.style.display = 'none';
Â  Â  Â  Â  Â  Â  //elements.guessCount.style.display = 'none';
Â  Â  Â  Â  Â  Â  //elements.guessSuitsForm.style.display = 'none';
Â  Â  Â  Â  Â  Â  elements.responseButtons.style.display = 'none';
Â  Â  Â  Â  }

Â  Â  Â  Â  function joinRoom() {
Â  Â  Â  Â  Â  Â  myName = elements.playerNameInput.value.trim();
Â  Â  Â  Â  Â  Â  myRoomId = elements.roomIdInput.value.trim();

Â  Â  Â  Â  Â  Â  if (myName && myRoomId) {
Â  Â  Â  Â  Â  Â  Â  Â  connectWebSocket();
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  elements.lobbyMessage.textContent = 'Ğ‘ÑƒĞ´ÑŒ Ğ»Ğ°ÑĞºĞ°, Ğ²Ğ²ĞµĞ´Ñ–Ñ‚ÑŒ Ñ–Ğ¼\'Ñ Ñ‚Ğ° ID ĞºÑ–Ğ¼Ğ½Ğ°Ñ‚Ğ¸.';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

        function addLogEntry(message, type) {
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}-log`;
            logEntry.textContent = message;
            elements.log.appendChild(logEntry);  // <--- Ğ’Ğ˜ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ Ğ¢Ğ£Ğ¢
            elements.log.scrollTop = elements.log.scrollHeight; // <--- Ğ’Ğ˜ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ Ğ¢Ğ£Ğ¢
        }

Â  Â  Â  Â  function connectWebSocket() {
Â  Â  Â  Â  Â  Â  socket = new WebSocket(WS_URL);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  socket.onopen = () => {
Â  Â  Â  Â  Â  Â  Â  Â  logMessage("ĞŸÑ–Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾ Ğ´Ğ¾ ÑĞµÑ€Ğ²ĞµÑ€Ğ°. ĞĞ°Ğ´ÑĞ¸Ğ»Ğ°Ñ”Ğ¼Ğ¾ Ñ–Ğ¼'Ñ Ğ³Ñ€Ğ°Ğ²Ñ†Ñ Ñ‚Ğ° ID ĞºÑ–Ğ¼Ğ½Ğ°Ñ‚Ğ¸...");
                // ĞĞ¾Ğ²Ğ¸Ğ¹, Ğ²Ğ¸Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹ ĞºĞ¾Ğ´:
                   const message_to_send = { type: 'join', name: myName, room: myRoomId };
                   addLogEntry(`ĞĞ°Ğ´ÑĞ¸Ğ»Ğ°Ñ: ${JSON.stringify(message_to_send)}`, 'system');
                   socket.send(JSON.stringify(message_to_send));
Â  Â  Â  Â  Â  Â         };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  socket.onmessage = (event) => {
Â  Â  Â  Â  Â  Â  Â  Â  const data = JSON.parse(event.data);
Â  Â  Â  Â  Â  Â  Â  Â  logMessage(`ĞÑ‚Ñ€Ğ¸Ğ¼Ğ°Ğ½Ğ¾: ${event.data}`);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  switch (data.type) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'joined_room':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  elements.lobby.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  elements.game.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  logMessage(`ĞŸÑ€Ğ¸Ñ”Ğ´Ğ½Ğ°Ğ½Ğ¾ Ğ´Ğ¾ ĞºÑ–Ğ¼Ğ½Ğ°Ñ‚Ğ¸: ${myRoomId}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'update_state':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateUI(data.state, data.state.my_hand);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'start_game':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  logMessage('Ğ“Ñ€Ğ° Ñ€Ğ¾Ğ·Ğ¿Ğ¾Ñ‡Ğ°Ğ»Ğ°ÑÑŒ!');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'game_over':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  logMessage(`Ğ“Ñ€Ğ° Ğ·Ğ°ĞºÑ–Ğ½Ñ‡ĞµĞ½Ğ°! ĞŸĞµÑ€ĞµĞ¼Ğ¾Ğ¶ĞµÑ†ÑŒ: ${data.winner}.`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'ask_response_needed':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hideAllControls();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  elements.responseButtons.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  elements.askingPlayerName.textContent = data.asking_player;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  elements.askedCardRank.textContent = data.card_rank;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'guess_count_needed':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hideAllControls();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  elements.guessCount.style.display = 'block';
                        break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'guess_suits_needed':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hideAllControls();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  elements.guessSuitsForm.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'log':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  logMessage(data.message);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'error':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  logMessage(`ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°: ${data.message}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  socket.onclose = () => {
Â  Â  Â  Â  Â  Â  Â  Â  logMessage("Ğ’Ñ–Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾ Ğ²Ñ–Ğ´ ÑĞµÑ€Ğ²ĞµÑ€Ğ°. Ğ¡Ğ¿Ñ€Ğ¾Ğ±Ğ° Ğ¿ĞµÑ€ĞµĞ¿Ñ–Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ½Ñ Ñ‡ĞµÑ€ĞµĞ· 5 ÑĞµĞºÑƒĞ½Ğ´...");
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(connectWebSocket, 5000);
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  socket.onerror = (error) => {
Â  Â  Â  Â  Â  Â  Â  Â  logMessage(`ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° WebSocket: ${error}`);
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  }

Â  Â  Â  Â  function startGame() {
Â  Â  Â  Â  Â  Â  if (socket.readyState === WebSocket.OPEN) {
                  const message_to_send = { type: 'start_game', room: myRoomId };
                // Ğ›Ğ¾Ğ³ÑƒÑ”Ğ¼Ğ¾ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ Ğ¿ĞµÑ€ĞµĞ´ Ğ²Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²ĞºĞ¾Ñ
                addLogEntry(`ĞĞ°Ğ´ÑĞ¸Ğ»Ğ°Ñ: ${JSON.stringify(message_to_send)}`, 'system');
                 // Ğ’Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑ”Ğ¼Ğ¾ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ
                socket.send(JSON.stringify(message_to_send));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function askForCard() {
Â  Â  Â  Â  Â  Â  const targetPlayer = elements.targetPlayerSelect.value;
Â  Â  Â  Â  Â  Â  const cardRank = elements.cardRankSelect.value;
Â  Â  Â  Â  Â  Â  if (targetPlayer && cardRank) {
                  const message_to_send = {type: 'ask_card', room: myRoomId, target: targetPlayer, card_rank: cardRank };
                // Ğ›Ğ¾Ğ³ÑƒÑ”Ğ¼Ğ¾ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ Ğ¿ĞµÑ€ĞµĞ´ Ğ²Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²ĞºĞ¾Ñ
                  addLogEntry(`ĞĞ°Ğ´ÑĞ¸Ğ»Ğ°Ñ: ${JSON.stringify(message_to_send)}`, 'system');
               // Ğ’Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑ”Ğ¼Ğ¾ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ
                  socket.send(JSON.stringify(message_to_send)); 
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  logMessage('Ğ‘ÑƒĞ´ÑŒ Ğ»Ğ°ÑĞºĞ°, Ğ²Ğ¸Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ Ğ³Ñ€Ğ°Ğ²Ñ†Ñ Ñ‚Ğ° Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ ĞºĞ°Ñ€Ñ‚Ğ¸.');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function respondToAsk(response) {
Â  Â  Â  Â  Â  Â  socket.send(JSON.stringify({ type: 'ask_response', room: myRoomId, response: response }));
Â  Â  Â  Â  Â  Â  hideAllControls();
Â  Â  Â  Â  }

Â  Â  Â  Â  function guessSuits() {
Â  Â  Â  Â  Â  Â  const suits = Array.from(elements.suitsCheckboxes.querySelectorAll('input:checked')).map(cb => cb.value);
Â  Â  Â  Â  Â  Â  if (suits.length > 0) {
                const message_to_send = { type: 'guess_suits', room: myRoomId, suits: suits };
                // Ğ›Ğ¾Ğ³ÑƒÑ”Ğ¼Ğ¾ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ Ğ¿ĞµÑ€ĞµĞ´ Ğ²Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²ĞºĞ¾Ñ
                addLogEntry(`ĞĞ°Ğ´ÑĞ¸Ğ»Ğ°Ñ: ${JSON.stringify(message_to_send)}`, 'system');
               // Ğ’Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑ”Ğ¼Ğ¾ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ
                socket.send(JSON.stringify(message_to_send));
                elements.guessSuitsForm.style.display = 'none';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  logMessage('Ğ‘ÑƒĞ´ÑŒ Ğ»Ğ°ÑĞºĞ°, Ğ²Ğ¸Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ Ğ¼Ğ°ÑÑ‚Ñ–.');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

      // Ğ”Ğ¾Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ¾Ğ±Ñ€Ğ¾Ğ±Ğ½Ğ¸Ğº Ğ¿Ğ¾Ğ´Ñ–Ğ¹ Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ğ¾Ñ— ĞºĞ½Ğ¾Ğ¿ĞºĞ¸
      elements.submitGuessCountBtn.onclick = () => {
      const count = parseInt(elements.guessCountInput.value, 10);

      if (!isNaN(count)) {
          const message_to_send = { type: 'guess_count', room: myRoomId, count: count };
          // Ğ›Ğ¾Ğ³ÑƒÑ”Ğ¼Ğ¾ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ Ğ¿ĞµÑ€ĞµĞ´ Ğ²Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²ĞºĞ¾Ñ
          addLogEntry(`ĞĞ°Ğ´ÑĞ¸Ğ»Ğ°Ñ: ${JSON.stringify(message_to_send)}`, 'system');    
          // Ğ’Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑ”Ğ¼Ğ¾ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ
          socket.send(JSON.stringify(message_to_send));
          elements.guessCount.style.display = 'none'; // Ñ…Ğ¾Ğ²Ğ°Ñ”Ğ¼Ğ¾ Ñ„Ğ¾Ñ€Ğ¼Ñƒ Ğ¿Ñ–ÑĞ»Ñ Ğ²Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸
      } else {
          logMessage('Ğ‘ÑƒĞ´ÑŒ Ğ»Ğ°ÑĞºĞ°, Ğ²Ğ¸Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ ĞºÑ–Ğ»ÑŒĞºÑ–ÑÑ‚ÑŒ.');
      }
  };



            
Â  Â  </script>
</body>
</html>
